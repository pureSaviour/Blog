<!DOCTYPE html>
<html lang="zh-CN">
<head>
	<meta charset="UTF-8">
	<title>验证密钥 - 笔记仓库</title>
	<link rel="stylesheet" href="https://cdn.bootcdn.net/ajax/libs/tailwindcss/2.2.19/tailwind.min.css">
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen">
<div class="bg-white p-8 rounded-lg shadow-md w-96">
	<h3 class="text-xl font-bold mb-6 text-center">笔记仓库 - 密钥验证</h3>
	<div class="mb-4">
		<label class="block mb-2">请输入访问密钥：</label>
		<input type="password" id="accessKey" class="w-full px-3 py-2 border rounded" placeholder="输入密钥">
	</div>
	<button onclick="verifyKey()" class="w-full bg-blue-500 text-white py-2 rounded hover:bg-blue-600">验证并访问</button>
	<p id="errorMsg" class="text-red-500 text-center mt-3"></p>
</div>

<script>
    // 获取URL中的笔记ID（比如页面跳转时带参数：key-verify.html?id=1）
    const urlParams = new URLSearchParams(window.location.search);
    const articleId = urlParams.get('id');

    // 验证密钥
    async function verifyKey() {
        const accessKey = document.getElementById('accessKey').value;
        if (!accessKey) {
            document.getElementById('errorMsg').textContent = '请输入密钥！';
            return;
        }

        try {
            const response = await fetch(`/api/articles/verify-key/${articleId}`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ access_key: accessKey })
            });
            const res = await response.json();
            if (res.success) {
                // 验证成功，跳转到笔记详情页（可传密钥标识，避免重复验证）
                window.location.href = `/detail.html?id=${articleId}&key=${accessKey}`;
            } else {
                document.getElementById('errorMsg').textContent = res.message;
            }
        } catch (err) {
            document.getElementById('errorMsg').textContent = '网络错误：' + err.message;
        }
    }
</script>
</body>
</html>